webpackJsonp([20],{207:function(i,t,n){function a(i){n(506)}var e=n(5)(n(331),n(650),a,null,null);i.exports=e.exports},226:function(i,t,n){"use strict";function a(i){return b(e(d(i),i.length*m))}function e(i,t){i[t>>5]|=128<<t%32,i[14+(t+64>>>9<<4)]=t;for(var n=1732584193,a=-271733879,e=-1732584194,r=271733878,p=0;p<i.length;p+=16){var d=n,b=a,A=e,m=r;n=o(n,a,e,r,i[p+0],7,-680876936),r=o(r,n,a,e,i[p+1],12,-389564586),e=o(e,r,n,a,i[p+2],17,606105819),a=o(a,e,r,n,i[p+3],22,-1044525330),n=o(n,a,e,r,i[p+4],7,-176418897),r=o(r,n,a,e,i[p+5],12,1200080426),e=o(e,r,n,a,i[p+6],17,-1473231341),a=o(a,e,r,n,i[p+7],22,-45705983),n=o(n,a,e,r,i[p+8],7,1770035416),r=o(r,n,a,e,i[p+9],12,-1958414417),e=o(e,r,n,a,i[p+10],17,-42063),a=o(a,e,r,n,i[p+11],22,-1990404162),n=o(n,a,e,r,i[p+12],7,1804603682),r=o(r,n,a,e,i[p+13],12,-40341101),e=o(e,r,n,a,i[p+14],17,-1502002290),a=o(a,e,r,n,i[p+15],22,1236535329),n=l(n,a,e,r,i[p+1],5,-165796510),r=l(r,n,a,e,i[p+6],9,-1069501632),e=l(e,r,n,a,i[p+11],14,643717713),a=l(a,e,r,n,i[p+0],20,-373897302),n=l(n,a,e,r,i[p+5],5,-701558691),r=l(r,n,a,e,i[p+10],9,38016083),e=l(e,r,n,a,i[p+15],14,-660478335),a=l(a,e,r,n,i[p+4],20,-405537848),n=l(n,a,e,r,i[p+9],5,568446438),r=l(r,n,a,e,i[p+14],9,-1019803690),e=l(e,r,n,a,i[p+3],14,-187363961),a=l(a,e,r,n,i[p+8],20,1163531501),n=l(n,a,e,r,i[p+13],5,-1444681467),r=l(r,n,a,e,i[p+2],9,-51403784),e=l(e,r,n,a,i[p+7],14,1735328473),a=l(a,e,r,n,i[p+12],20,-1926607734),n=s(n,a,e,r,i[p+5],4,-378558),r=s(r,n,a,e,i[p+8],11,-2022574463),e=s(e,r,n,a,i[p+11],16,1839030562),a=s(a,e,r,n,i[p+14],23,-35309556),n=s(n,a,e,r,i[p+1],4,-1530992060),r=s(r,n,a,e,i[p+4],11,1272893353),e=s(e,r,n,a,i[p+7],16,-155497632),a=s(a,e,r,n,i[p+10],23,-1094730640),n=s(n,a,e,r,i[p+13],4,681279174),r=s(r,n,a,e,i[p+0],11,-358537222),e=s(e,r,n,a,i[p+3],16,-722521979),a=s(a,e,r,n,i[p+6],23,76029189),n=s(n,a,e,r,i[p+9],4,-640364487),r=s(r,n,a,e,i[p+12],11,-421815835),e=s(e,r,n,a,i[p+15],16,530742520),a=s(a,e,r,n,i[p+2],23,-995338651),n=c(n,a,e,r,i[p+0],6,-198630844),r=c(r,n,a,e,i[p+7],10,1126891415),e=c(e,r,n,a,i[p+14],15,-1416354905),a=c(a,e,r,n,i[p+5],21,-57434055),n=c(n,a,e,r,i[p+12],6,1700485571),r=c(r,n,a,e,i[p+3],10,-1894986606),e=c(e,r,n,a,i[p+10],15,-1051523),a=c(a,e,r,n,i[p+1],21,-2054922799),n=c(n,a,e,r,i[p+8],6,1873313359),r=c(r,n,a,e,i[p+15],10,-30611744),e=c(e,r,n,a,i[p+6],15,-1560198380),a=c(a,e,r,n,i[p+13],21,1309151649),n=c(n,a,e,r,i[p+4],6,-145523070),r=c(r,n,a,e,i[p+11],10,-1120210379),e=c(e,r,n,a,i[p+2],15,718787259),a=c(a,e,r,n,i[p+9],21,-343485551),n=u(n,d),a=u(a,b),e=u(e,A),r=u(r,m)}return Array(n,a,e,r)}function r(i,t,n,a,e,r){return u(p(u(u(t,i),u(a,r)),e),n)}function o(i,t,n,a,e,o,l){return r(t&n|~t&a,i,t,e,o,l)}function l(i,t,n,a,e,o,l){return r(t&a|n&~a,i,t,e,o,l)}function s(i,t,n,a,e,o,l){return r(t^n^a,i,t,e,o,l)}function c(i,t,n,a,e,o,l){return r(n^(t|~a),i,t,e,o,l)}function u(i,t){var n=(65535&i)+(65535&t);return(i>>16)+(t>>16)+(n>>16)<<16|65535&n}function p(i,t){return i<<t|i>>>32-t}function d(i){for(var t=Array(),n=(1<<m)-1,a=0;a<i.length*m;a+=m)t[a>>5]|=(i.charCodeAt(a/m)&n)<<a%32;return t}function b(i){for(var t=A?"0123456789ABCDEF":"0123456789abcdef",n="",a=0;a<4*i.length;a++)n+=t.charAt(i[a>>2]>>a%4*8+4&15)+t.charAt(i[a>>2]>>a%4*8&15);return n}t.a=a;var A=0,m=8},331:function(i,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(48),e=n.n(a),r=n(16),o=n.n(r),l=n(84),s=n.n(l),c=n(15),u=n.n(c),p=(n(13),n(226)),d=Date.now();t.default={data:function(){return{isClk:!0,album:{pic:[]},delConfirm:{title:null,visible:!1,item:null},uploader:{timestamp:d,token:n.i(p.a)("fitment_"+d),type:"images"}}},mounted:function(){this.reload()},methods:{reload:function(){var i=this;return u()(o.a.mark(function t(){var n,a,e,r,l,c,u,p;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.http("/picApi/factoryAlbumInfo",{data:{id:i.$route.params.id},method:"POST"});case 2:if(n=t.sent,a=n.data,!a.code){t.next=9;break}that.$Message.error(a.msg.zh),i.album={pic:[]},t.next=29;break;case 9:for(e=!0,r=!1,l=void 0,t.prev=12,c=s()(a.result.album.pic);!(e=(u=c.next()).done);e=!0)p=u.value,p.dd={ing:!1,x:0,y:0};t.next=20;break;case 16:t.prev=16,t.t0=t.catch(12),r=!0,l=t.t0;case 20:t.prev=20,t.prev=21,!e&&c.return&&c.return();case 23:if(t.prev=23,!r){t.next=26;break}throw l;case 26:return t.finish(23);case 27:return t.finish(20);case 28:i.album=a.result.album;case 29:case"end":return t.stop()}},t,i,[[12,16,20,28],[21,,23,27]])}))()},beforeUpload:function(i){this.$Loading.start()},uploadComplete:function(i,t,n){var a=!0,e=!1,r=void 0;try{for(var o,l=s()(n);!(a=(o=l.next()).done);a=!0){if("finished"!==o.value.status)return}}catch(i){e=!0,r=i}finally{try{!a&&l.return&&l.return()}finally{if(e)throw r}}var c=[],u=!0,p=!1,d=void 0;try{for(var b,A=s()(n);!(u=(b=A.next()).done);u=!0){var m=b.value;m.response.code||c.push(m.response.result.file)}}catch(i){p=!0,d=i}finally{try{!u&&A.return&&A.return()}finally{if(p)throw d}}this.$Loading.finish(),c.length>0&&this.addPic(c),this.$refs.uploader.clearFiles()},uploadError:function(){this.$Loading.finish()},addPic:function(i){var t=this.album.pic.map(function(i){return i.url}),n=!0,a=!1,r=void 0;try{for(var o,l=s()(i);!(n=(o=l.next()).done);n=!0){var c=o.value;t.push(c)}}catch(i){a=!0,r=i}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}this.save("pic",e()(t))},save:function(i,t){var n=this;return u()(o.a.mark(function a(){var e,r,l;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e={title:n.album.title,share_content:n.album.share_content,share_icon:n.album.share_icon,close_share:n.album.close_share,background:n.album.background,music:n.album.music,close_ad:n.album.close_ad,album_id:n.album.id,modify_pic:"pic"===i?1:0},e[i]=t,a.next=4,n.http("/picApi/factoryAlbumModify",{data:e,method:"POST"});case 4:r=a.sent,l=r.data,l.code?n.$Message.error(l.msg.zh):(n.$Message.success("修改成功"),n.reload());case 7:case"end":return a.stop()}},a,n)}))()},delAll:function(){var i=this;this.delConfirm.title="确定要删除全部吗?",this.delConfirm.item=null,this.delConfirm.visible=!0,this.$nextTick(function(){i.$refs.cfbtn.$el.focus()})},del:function(i,t){var n=this;this.delConfirm.title="确定要删除吗?",this.delConfirm.item=i,this.delConfirm.visible=!0,this.$nextTick(function(){n.$refs.cfbtn.$el.focus()})},doDel:function(){var i=this;if(this.delConfirm.item){var t=this.album.pic.filter(function(t){return t!==i.delConfirm.item}).map(function(i){return i.url});this.save("pic",e()(t))}else this.save("pic",e()([]));this.delConfirm.visible=!1},editUploadComplete:function(i,t,n){if(this.$Loading.finish(),i.code)return void this.$Message.error(i.msg.zh);var a=[],r=!0,o=!1,l=void 0;try{for(var c,u=s()(this.album.pic);!(r=(c=u.next()).done);r=!0){var p=c.value;p===this.curr?a.push(i.result.file):a.push(p.url)}}catch(i){o=!0,l=i}finally{try{!r&&u.return&&u.return()}finally{if(o)throw l}}this.save("pic",e()(a))},changeCurr:function(i){this.curr=i},movestart:function(i,t,n){var a=this;this.isClk=!0;var r=!1,o=function(i){return{x:i.clientX,y:i.clientY}},l=function(i,t,n){return i>n.x&&i<n.x1&&t>n.y&&t<n.y1},s=function(i,t){var n=i.offset();return n.left=n.left-t.left,n.top=n.top-t.top,n},c=!1;t.dd.ing=!0;var u=$(this.$refs.albumpics),p=$(this.$refs["ref"+t.id]),d=o(i),b=u.offset(),A=s(p,b),m=p.width(),f=p.height(),h=A.left+m/2,g=A.top+f/2;t.dd.x=A.left,t.dd.y=A.top,t.dd.pdHeight=p.height();var C=function(i){a.isClk=!1,i.preventDefault();var e=o(i),r=e.x-d.x,u=e.y-d.y;t.dd.x=A.left+r,t.dd.y=A.top+u;for(var p=h+r,m=g+u,f=0;f<a.album.pic.length;f++){var C=a.album.pic[f];if(n!==f){var v=$(a.$refs["ref"+C.id]),x=s(v,b),B=v.width(),w=v.height(),k={x:x.left,x1:x.left+B,y:x.top,y1:x.top+w};if(f===a.album.pic.length-1&&p>k.x1&&m>k.y)a.album.pic.splice(n,1),a.album.pic.push(t),n=f;else if(l(p,m,k)){var y=f-1;p>k.x+B/2&&(y=f),n!==y&&(a.album.pic.splice(n,1),y<n&&y--,a.album.pic.splice(y,0,t),n=y,c=!0);break}}}},v=function(){if(!r&&(r=!0,t.dd.ing=!1,t.dd.x=0,t.dd.y=0,$(window).off("mousemove"),$(window).off("mouseup"),c)){var i=a.album.pic.map(function(i){return i.url});a.save("pic",e()(i))}};$(window).on("mousemove",C),$(window).on("mouseup",v)},toDetail:function(i,t){this.isClk&&(window.localStorage.setItem("galleryPage",t),this.$router.push({name:"画册翻页",params:{id:this.$route.params.id},query:{width:i.thumbnail_width,height:i.thumbnail_height}}))}},watch:{$route:function(){this.reload()}}}},421:function(i,t,n){t=i.exports=n(202)(!0),t.push([i.i,'.albumpics-tbtn{display:inline-block;vertical-align:middle;margin-right:10px;border:none;color:#666}.albumpics-tbtn .ivu-upload-drag{border:none!important;color:#2d8cf0!important}.albumpics-tbtn.albumpics-tbtn-img{margin-right:0}.albumpics-content{padding:14px}.albumpics{-ms-flex-wrap:wrap;flex-wrap:wrap;position:relative}.albumpic{margin:15px 14px;width:180px;font-size:0;background:#fff;position:relative}.albumpic-content{cursor:pointer}.albumpic-content>img{width:100%}.albumpic-img{cursor:pointer;width:180px;background-color:#e4e4e4;background-repeat:no-repeat;background-position:top;background-size:contain}.zalbumpic-bbar{height:16px;background:hsla(0,0%,40%,.8);padding:0 12px;line-height:16px;color:#b7b7b7}.zalbumpic-bbar-txt{font-size:12px}.zalbumpic-bbar-sm{height:8px}.zalbumpic-bbar-img{vertical-align:top;display:inline-block;width:8px;height:8px;margin-left:6px;cursor:pointer;background-repeat:no-repeat;background-position:50%;background-size:contain}.zalbumpic-bbar-img.icon-del:hover{background-image:url("/static/albums/album-del1-on.png")}.zalbumpic-bbar-img.icon-del{background-image:url("/static/albums/album-del1.png")}.zalbumpic-bbar-img.icon-img:hover{background-image:url("/static/albums/album-img-on.png")}.zalbumpic-bbar-img.icon-img{background-image:url("/static/albums/album-img.png")}.albumpic-dd-pd{width:180px;border:1px dashed #ccc}.albumpic-dd-ing{z-index:9999;position:absolute}.xbox-shadow{-webkit-box-shadow:3px 3px 6px 3px rgba(0,0,0,.5);box-shadow:3px 3px 6px 3px rgba(0,0,0,.5)}',"",{version:3,sources:["/Users/ouchuanyu/work/repo/zhuangbei/zbqd/src/pages/album/pics.vue"],names:[],mappings:"AACA,gBACE,qBAAsB,AACtB,sBAAuB,AACvB,kBAAmB,AACnB,YAAa,AACb,UAAY,CACb,AACD,iCACE,sBAAuB,AACvB,uBAAyB,CAC1B,AACD,mCACE,cAAkB,CACnB,AACD,mBACE,YAAc,CACf,AACD,WACE,mBAAoB,AAChB,eAAgB,AACpB,iBAAmB,CACpB,AACD,UACE,iBAAkB,AAClB,YAAa,AACb,YAAa,AACb,gBAAiB,AACjB,iBAAmB,CACpB,AACD,kBACE,cAAgB,CACjB,AACD,sBACE,UAAY,CACb,AACD,cACE,eAAgB,AAChB,YAAa,AACb,yBAA0B,AAC1B,4BAA6B,AAC7B,wBAAgC,AAChC,uBAAyB,CAC1B,AACD,gBACE,YAAa,AACb,6BAAqC,AACrC,eAAgB,AAChB,iBAAkB,AAClB,aAAe,CAChB,AACD,oBACE,cAAgB,CACjB,AACD,mBACE,UAAY,CACb,AACD,oBACE,mBAAoB,AACpB,qBAAsB,AACtB,UAAW,AACX,WAAY,AACZ,gBAAiB,AACjB,eAAgB,AAChB,4BAA6B,AAC7B,wBAA4B,AAC5B,uBAAyB,CAC1B,AACD,mCACE,wDAA0D,CAC3D,AACD,6BACE,qDAAuD,CACxD,AACD,mCACE,uDAAyD,CAC1D,AACD,6BACE,oDAAsD,CACvD,AACD,gBACE,YAAa,AACb,sBAAwB,CACzB,AACD,iBACE,aAAc,AACd,iBAAmB,CACpB,AACD,aACE,kDAAuD,AAC/C,yCAA+C,CACxD",file:"pics.vue",sourcesContent:["\n.albumpics-tbtn {\n  display: inline-block;\n  vertical-align: middle;\n  margin-right: 10px;\n  border: none;\n  color: #666;\n}\n.albumpics-tbtn .ivu-upload-drag {\n  border: none!important;\n  color: #2d8cf0!important;\n}\n.albumpics-tbtn.albumpics-tbtn-img {\n  margin-right: 0px;\n}\n.albumpics-content {\n  padding: 14px;\n}\n.albumpics {\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  position: relative;\n}\n.albumpic {\n  margin: 15px 14px;\n  width: 180px;\n  font-size: 0;\n  background: #fff;\n  position: relative;\n}\n.albumpic-content {\n  cursor: pointer;\n}\n.albumpic-content > img {\n  width: 100%;\n}\n.albumpic-img {\n  cursor: pointer;\n  width: 180px;\n  background-color: #E4E4E4;\n  background-repeat: no-repeat;\n  background-position: top center;\n  background-size: contain;\n}\n.zalbumpic-bbar {\n  height: 16px;\n  background: rgba(102, 102, 102, 0.8);\n  padding: 0 12px;\n  line-height: 16px;\n  color: #b7b7b7;\n}\n.zalbumpic-bbar-txt {\n  font-size: 12px;\n}\n.zalbumpic-bbar-sm {\n  height: 8px;\n}\n.zalbumpic-bbar-img {\n  vertical-align: top;\n  display: inline-block;\n  width: 8px;\n  height: 8px;\n  margin-left: 6px;\n  cursor: pointer;\n  background-repeat: no-repeat;\n  background-position: center;\n  background-size: contain;\n}\n.zalbumpic-bbar-img.icon-del:hover {\n  background-image: url('/static/albums/album-del1-on.png');\n}\n.zalbumpic-bbar-img.icon-del {\n  background-image: url('/static/albums/album-del1.png');\n}\n.zalbumpic-bbar-img.icon-img:hover {\n  background-image: url('/static/albums/album-img-on.png');\n}\n.zalbumpic-bbar-img.icon-img {\n  background-image: url('/static/albums/album-img.png');\n}\n.albumpic-dd-pd {\n  width: 180px;\n  border: 1px dashed #ccc;\n}\n.albumpic-dd-ing {\n  z-index: 9999;\n  position: absolute;\n}\n.xbox-shadow {\n  -webkit-box-shadow: 3px 3px 6px 3px rgba(0, 0, 0, 0.5);\n          box-shadow: 3px 3px 6px 3px rgba(0, 0, 0, 0.5);\n}\n"],sourceRoot:""}])},506:function(i,t,n){var a=n(421);"string"==typeof a&&(a=[[i.i,a,""]]),a.locals&&(i.exports=a.locals);n(203)("35d56f5b",a,!0,{})},650:function(i,t){i.exports={render:function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("i-page",{attrs:{aside:!1}},[n("div",{attrs:{slot:"header-handler"},slot:"header-handler"},[n("a",{staticClass:"albumpics-tbtn",attrs:{href:"javascript:void(0)"},on:{click:function(t){i.$router.go(-1)}}},[i._v("返回")]),i._v(" "),n("Upload",{ref:"uploader",staticClass:"albumpics-tbtn",attrs:{data:i.uploader,"show-upload-list":!1,type:"drag",name:"Filedata",action:i.api+"/uploadFile","before-upload":i.beforeUpload,"on-success":i.uploadComplete,"on-error":i.uploadError,accept:"image/*",multiple:""}},[i._v("\n            添加页面\n        ")]),i._v(" "),n("a",{staticClass:"albumpics-tbtn",attrs:{href:"javascript:void(0)"},on:{click:i.delAll}},[i._v("全部删除")])],1),i._v(" "),n("div",{staticClass:"albumpics-content",attrs:{slot:"page-content"},slot:"page-content"},[n("div",{ref:"albumpics",staticClass:"albumpics flex"},[i._l(i.album.pic,function(t,a){return[n("div",{staticClass:"albumpic xbox-shadow",class:{"albumpic-dd-ing":t.dd.ing},style:{top:t.dd.y+"px",left:t.dd.x+"px"}},[n("div",{ref:"ref"+t.id,refInFor:!0,staticClass:"albumpic-content",on:{mousedown:function(n){i.movestart(n,t,a)},click:function(n){i.toDetail(t,a)}}},[n("img",{attrs:{src:i.server+t.thumbnail}})]),i._v(" "),n("div",{staticClass:"flex space-between zalbumpic-bbar"},[n("div",{staticClass:"zalbumpic-bbar-txt"},[i._v(i._s(0===a?"封面":"内页"+a))]),i._v(" "),n("div",{staticClass:"zalbumpic-bbar-sm",on:{click:function(n){i.changeCurr(t)}}},[n("Upload",{staticClass:"albumpics-tbtn albumpics-tbtn-img zalbumpic-bbar-img icon-img",attrs:{data:i.uploader,"show-upload-list":!1,type:"drag",name:"Filedata",action:i.api+"/uploadFile","before-upload":i.beforeUpload,"on-success":i.editUploadComplete,"on-error":i.uploadError,accept:"image/*"}},[i._v("\n                                 \n                            ")]),i._v(" "),n("div",{staticClass:"zalbumpic-bbar-img icon-del",on:{click:function(n){i.del(t,a)}}})],1)])]),i._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.dd.ing,expression:"item.dd.ing"}],ref:"pd"+t.id,refInFor:!0,staticClass:"albumpic albumpic-dd-pd",style:{height:t.dd.pdHeight+"px"}})]})],2),i._v(" "),n("Modal",{attrs:{width:"360"},model:{value:i.delConfirm.visible,callback:function(t){i.$set(i.delConfirm,"visible",t)},expression:"delConfirm.visible"}},[n("p",{attrs:{slot:"header"},slot:"header"},[i._v("\n                提示\n            ")]),i._v(" "),n("div",[n("p",[i._v(i._s(i.delConfirm.title))])]),i._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"default",size:"large"},on:{click:function(t){i.delConfirm.visible=!1}}},[i._v("取消")]),i._v(" "),n("Button",{ref:"cfbtn",attrs:{type:"info",size:"large"},on:{click:i.doDel}},[i._v("确定")])],1)])],1)])},staticRenderFns:[]}}});
//# sourceMappingURL=20.a04b1a28ea145388e1cd.js.map